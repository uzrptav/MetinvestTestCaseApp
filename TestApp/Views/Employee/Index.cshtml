@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>
    function removeEmployee() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {
            $.messager.confirm('Confirm', 'Are you sure you want to delete this employee?', function (r) {
                if (r) {

                    $.ajax({
                        url: "/Employee/RemoveEmployee",
                        type: 'post',
                        cache: false,
                        dataType: 'html',
                        data: { id: row.EmployeeID },
                        success: function (data) {
                            if (data == "Success") {
                                $("#dg").datagrid('reload');
                                $.messager.alert('Success', data, 'info');
                            }
                            else $.messager.alert('Error', 'Error！', 'info');
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            alert(textStatus); return;
                        }
                    });
                }
            });
        }
    }
</script>

@*<form id="upload" enctype="multipart/form-data" action="@Url.Action("UploadFile", "Employee")" method="POST">
    <input type="file" name="fileUpload" id="fileUpload" accept=".json" /><br />
    <button>Upload!</button>
</form>*@

<script>
    function uploadJsonFile() {
        $('#dlgJsonFile').dialog('open').dialog('setTitle', 'Upload Json file');
    }


    $('#upload').submit(function (e) {
        e.preventDefault(); // stop the standard form submission

        $.ajax({
            url: this.action,
            type: this.method,
            data: new FormData(this),
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                console.log(data.UploadedFileCount + ' file(s) uploaded successfully');
                $('#dlgJsonFile').dialog('close');      // close the dialog
                $('#dg').datagrid('reload');            // reload the user data
            },
            error: function (xhr, error, status) {
                console.log(error, status);
            }
        });
    });
</script>

<table id="dg" title="My Employees" class="easyui-datagrid"
       url="~/Employee/EmployeeJSON"
       toolbar="#toolbar"
       fitColumns="true"
       rownumbers="true"
       singleSelect="true">
    <thead>
        <tr>
            <th data-options="field:'EmployeeID',width:60">Employee ID</th>
            <th data-options="field:'PersonnelID',width:60">Personnel ID</th>
            <th data-options="field:'EmployeeFullName',width:120,align:'right'">Employee Full Name</th>
            <th data-options="field:'DateOfBirth',width:80,align:'right'">Date Of Birth</th>
            <th data-options="field:'IsStaffMember',width:80">Is Staff Member</th>
        </tr>
    </thead>
</table>
<div id="toolbar">
    <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="newEmployee()">New Employee</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="uploadJsonFile()">Upload File</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="editEmployee()">Edit Employee</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="removeEmployee()">Remove Employee</a>
</div>

<div id="dlg" class="easyui-dialog" style="width:400px;height:320px;padding:10px 20px"
     closed="true" buttons="#dlg-buttons">

    <form id="fm" method="post" novalidate>
        <div class="fitem" style="margin-bottom:20px">
            <input type=hidden name="EmployeeID" class="easyui-textbox" required="true">
        </div>

        <div class="fitem" style="margin-bottom:20px">
            <label>Personnel ID:</label>
            <input name="PersonnelID" class="easyui-textbox" required="true">
        </div>
        <div class="fitem" style="margin-bottom:20px">
            <label>Employee Full Name:</label>
            <input name="EmployeeFullName" class="easyui-textbox" required="true">
        </div>
        <div class="fitem" style="margin-bottom:20px">
            <label>Date Of Birth</label>
            <input name="DateOfBirth:" class="easyui-textbox">
        </div>
        <div class="fitem" style="margin-bottom:20px">
            <label>Is Staff Member</label>

            <input class="easyui-checkbox" name="IsStaffMember" value="true">
        </div>
    </form>
</div>

<div id="dlg-buttons">
    <a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="saveUser()" style="width:90px">Save</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')" style="width:90px">Cancel</a>
</div>

<div id="dlgJsonFile" class="easyui-dialog" style="width:400px;height:320px;padding:10px 20px"
     closed="true" buttons="#dlg-buttons">

    <form id="upload" enctype="multipart/form-data" action="@Url.Action("UploadFile", "Employee")" method="POST">
        <input type="file" name="fileUpload" id="fileUpload" accept=".json" /><br />
        <button>Upload!</button>
    </form>

</div>
<div id="dlg-buttons">
    @*<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="loadJsonFile()" style="width:90px">Save</a>*@
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgJsonFile').dialog('close')" style="width:90px">Cancel</a>
</div>

<script>
    var url;

    var employeeId;
    var params = {
        EmployeeID: '',
        PersonnelID: '',
        EmployeeFullName: '',
        DateOfBirth: '',
        IsStaffMember: '',
    };

    function newEmployee() {
        $('#dlg').dialog('open').dialog('setTitle', 'New Employee');
        $('#fm').form('clear');
        url = '/Employee/SaveEmployee';
    }

    function editEmployee() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {

            $('#dlg').dialog('open').dialog('setTitle', 'Edit User');
            $('#fm').form('load', row);
            employeeId = row.EmployeeID;
            url = '/Employee/EditEmployee?id=' + row.EmployeeID;
        }
    }

    function saveUser() {
        $('#fm').form('submit', {
            url: url,
            onSubmit: function (param) {
                params.EmployeeID = employeeId;
                params.PersonnelID = param.PersonnelID;
                params.EmployeeFullName = param.EmployeeFullName;
                params.DateOfBirth = param.DateOfBirth;
                params.IsStaffMember = param.IsStaffMember;
                return $(this).form('validate');
            },
            success: function (result) {
                var result = eval('(' + result + ')');
                if (result.errorMsg) {
                    $.messager.show({
                        title: 'Error',
                        msg: result.errorMsg
                    });
                } else {
                    $('#dlg').dialog('close');        // close the dialog
                    $('#dg').datagrid('reload');    // reload the user data
                }
            }
        });
    }
</script>
